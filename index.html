<!DOCTYPE html>
<html lang="uk">
<head>
  <title>ПравИло - Розумний коректор текстів</title>
  <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    textarea {
      height: 350px;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

  <!-- Кнопка для перемикання теми -->
  <div class="theme-switcher-container">
    <button onclick="toggleTheme()" class="secondary">Змінити тему</button>
  </div>

  <div class="container">
    <h1>ПравИло</h1>
    <h3>Розумний коректор українських текстів</h3>

    <textarea id="text-input" placeholder="Вставте ваш текст сюди..." aria-label="Поле для введення тексту"></textarea>

    <div class="button-container">
      <button onclick="cleanupText()">Виправити текст</button>
      <button onclick="copyText()" class="secondary">Копіювати текст</button>
      <button onclick="clearText()" class="secondary">Очистити поле</button>
    </div>

    <p id="status-label"></p>

    <p class="description">
      Цей інструмент автоматично виправляє поширені друкарські та пунктуаційні помилки в українському тексті. 
      Він замінює прямі лапки на типографські «ялинки», некоректні апострофи на правильний (’), дефіси на тире (—), 
      видаляє зайві пробіли та виконує багато інших мікрополіпшень для чистоти вашого тексту.
    </p>
  </div>

  <script>
    // ==== ЛОГІКА ПЕРЕМИКАННЯ ТЕМИ ====
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
      }
    });

    // ==== ОСНОВНА ЛОГІКА КОРЕКТОРА ====
    function cleanupText() {
      let text = document.getElementById("text-input").value;
      if (!text) {
        updateStatus("Поле вводу порожнє.", 0);
        return;
      }
      
      let fixesCount = 0;

      function applyRule(rule) {
        const newText = text.replace(rule.find, rule.replace);
        if (text !== newText) {
          const matches = text.match(rule.find);
          if (matches) fixesCount += matches.length;
        }
        text = newText;
      }

      const rules = [
        // 1. Нормалізація перенесень рядків (зберігаємо абзаци)
        { find: /\r\n/g, replace: '\n' },                // Уніфікуємо \r\n → \n
        { find: /\n{3,}/g, replace: '\n\n' },            // Не більше двох переносів поспіль
        { find: /([^\n])\n(?!\n)/g, replace: '$1 ' },    // Одинарний перенос → пробіл (злиття рядків)
        
        // 2. Видалення зайвих пробілів
        { find: / {2,}/g, replace: ' ' },
        { find: /^\s+|\s+$/g, replace: '' },
        { find: /\s+([.,;:!?»)])/g, replace: '$1' },
        { find: /\(\s+/g, replace: '(' },
        { find: /\s+\)/g, replace: ')' },

        // 3. Апостроф
        { find: /['`ʼ]/g, replace: '’' },

        // 4. Тире
        { find: / - /g, replace: ' — ' },
        { find: /^[-–] /gm, replace: '— ' },

        // 5. Багатокрапка
        { find: /\.{2,}/g, replace: '...' },
        { find: /…/g, replace: '...' },

        // 6. Пробіли після розділових знаків
        { find: /([.,;:!?»)])([^\s»”’])/g, replace: '$1 $2' },

        // 7. Нерозривні пробіли
        { find: /(\s[А-ЯІЇЄҐ])\.(\s*[А-ЯІЇЄҐ]\.)/g, replace: '$1.\u00A0$2' },
        { find: /(\s[А-ЯІЇЄҐ]\.)(\s*[А-ЯІЇЄҐ][а-яіїєґ]+)/g, replace: '$1\u00A0$2' },
        { find: /(\s[—-])(\s*)/g, replace: '\u00A0$1 ' },
      ];

      rules.forEach(applyRule);

      // === Лапки «ялинки» ===
      let inQuote = false;
      const quoteFixedText = text.replace(/["“”„]/g, () => {
        inQuote = !inQuote;
        return inQuote ? '«' : '»';
      });
      if (text !== quoteFixedText) {
        const matches = text.match(/["“”„]/g);
        if (matches) fixesCount += matches.length;
        text = quoteFixedText;
      }

      // === Фінальне очищення пробілів ===
      text = text
        .replace(/\s+([.,;:!?…—»)\]])/g, '$1') // пробіли перед пунктуацією
        .replace(/([«(\[])\s+/g, '$1')         // пробіли після відкривальних дужок/лапок
        .replace(/\s{2,}/g, ' ')               // кілька пробілів → один
        .replace(/^\s+|\s+$/g, '');            // пробіли на початку і в кінці

      document.getElementById("text-input").value = text;
      updateStatus("Виправлення завершено.", fixesCount);
    }

    // ==== ДОПОМІЖНІ ФУНКЦІЇ ====
    function copyText() {
      const text = document.getElementById("text-input").value;
      if (!text) {
        updateStatus("Немає що копіювати.", 0);
        return;
      }
      navigator.clipboard.writeText(text)
        .then(() => updateStatus("Текст скопійовано до буфера обміну.", -1))
        .catch(err => updateStatus("Не вдалося скопіювати текст: " + err, 0));
    }

    function clearText() {
      document.getElementById("text-input").value = "";
      updateStatus("Поле очищено.", 0);
    }

    function updateStatus(message, count) {
      const statusLabel = document.getElementById("status-label");
      if (count > 0) {
        statusLabel.innerHTML = `${message} Знайдено виправлень: <span id="fixes-count">${count}</span>`;
      } else {
        statusLabel.innerHTML = message;
      }
    }
  </script>

</body>
</html>
