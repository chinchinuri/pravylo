<!DOCTYPE html>
<html lang="uk">
<head>
  <title>–ü—Ä–∞–≤–ò–ª–æ ‚Äî –î–æ—Å–∫–æ–Ω–∞–ª–∏–π –∫–æ—Ä–µ–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç—ñ–≤</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–µ–º–∏ -->
  <div class="theme-switcher">
    <button id="theme-toggle-button" onclick="toggleTheme()" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É"></button>
  </div>

  <div class="container">
    <h1>–ü—Ä–∞–≤–ò–ª–æ</h1>
    <h3>–î–æ—Å–∫–æ–Ω–∞–ª–∏–π (–∞–±–æ –Ω–µ –¥—É–∂–µ) –∫–æ—Ä–µ–∫—Ç–æ—Ä —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö —Ç–µ–∫—Å—Ç—ñ–≤</h3>

    <textarea id="text-input" placeholder="–í—Å—Ç–∞–≤—Ç–µ –≤–∞—à —Ç–µ–∫—Å—Ç —Å—é–¥–∏..."></textarea>

    <div class="button-container">
      <button onclick="cleanupText()">–í–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç–µ–∫—Å—Ç</button>
      <button onclick="copyText()" class="secondary">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</button>
      <button onclick="clearText()" class="secondary">–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª–µ</button>
    </div>

    <p id="status-label"></p>

    <p class="description">
      –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–ª—è—î –ø–æ—à–∏—Ä–µ–Ω—ñ –¥—Ä—É–∫–∞—Ä—Å—å–∫—ñ —Ç–∞ –ø—É–Ω–∫—Ç—É–∞—Ü—ñ–π–Ω—ñ –ø–æ–º–∏–ª–∫–∏, –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—á–∏ —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ –≤—ñ–¥—Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π.
      –í—ñ–Ω —Ä–æ–∑—Å—Ç–∞–≤–ª—è—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ª–∞–ø–∫–∏, —Ç–∏—Ä–µ, –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∏, –ø—Ä–∏–±–∏—Ä–∞—î –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –¥–æ–¥–∞—î –Ω–µ—Ä–æ–∑—Ä–∏–≤–Ω—ñ –¥–ª—è –∫—Ä–∞—â–æ—ó —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ.
    </p>
  </div>

  <script>
    // ==== –õ–û–ì–Ü–ö–ê –ü–ï–†–ï–ú–ò–ö–ê–ù–ù–Ø –¢–ï–ú–ò ====
    const themeToggleButton = document.getElementById('theme-toggle-button');
    const sunIcon = '‚òÄÔ∏è';
    const moonIcon = 'üåô';

    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            themeToggleButton.innerHTML = sunIcon;
        } else {
            document.body.classList.remove('dark-mode');
            themeToggleButton.innerHTML = moonIcon;
        }
    }

    function toggleTheme() {
        const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(savedTheme || (prefersDark ? 'dark' : 'light'));
    });

    
    // ==== –û–°–ù–û–í–ù–ê –õ–û–ì–Ü–ö–ê –ö–û–†–ï–ö–¢–û–†–ê ====
    function cleanupText() {
        let text = document.getElementById("text-input").value;
        if (!text.trim()) {
            updateStatus("–ü–æ–ª–µ –≤–≤–æ–¥—É –ø–æ—Ä–æ–∂–Ω—î.", 0);
            return;
        }

        let fixesCount = 0;
        const placeholders = {};
        let placeholderIndex = 0;

        // --- –ï–¢–ê–ü 0: –ó–ê–•–ò–°–¢ –°–ü–ï–¶–Ü–ê–õ–¨–ù–ò–• –§–û–†–ú–ê–¢–Ü–í ---
        const patternsToProtect = [
            // Email-–∞–¥—Ä–µ—Å–∏
            /\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b/g,
            // URL-–∞–¥—Ä–µ—Å–∏ —Ç–∞ –¥–æ–º–µ–Ω–Ω—ñ —ñ–º–µ–Ω–∞
            /\b(https?:\/\/)?[a-zA-Z0-9.-]+\.(com|org|net|gov|ua|edu|dev|io|[a-z]{2,})(\/[^\s]*)?\b/g,
            // –ù–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ (—Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏)
            /(?:\+?\d{1,3}[-.\s]?)?\(?\d{2,5}\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,4}/g
        ];

        patternsToProtect.forEach(pattern => {
            text = text.replace(pattern, (match) => {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —â–æ–± –Ω–µ –∑–∞—Ö–∏—â–∞—Ç–∏ –≤–∂–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç
                if (match.startsWith('__PROTECTED_')) return match;
                const placeholder = `__PROTECTED_${placeholderIndex++}__`;
                placeholders[placeholder] = match;
                return placeholder;
            });
        });

        function applyRule(find, replace) {
            const matches = text.match(find);
            if (matches) fixesCount += matches.length;
            text = text.replace(find, replace);
        }

        // --- –ï–¢–ê–ü 1: –ë–ê–ó–û–í–ê –û–ß–ò–°–¢–ö–ê ---
        applyRule(/(\r\n|\r)/g, '\n');
        applyRule(/\n{3,}/g, '\n\n');
        applyRule(/[ \t]+$/gm, '');
        text = text.trim();

        // --- –ï–¢–ê–ü 2: –†–û–ë–û–¢–ê –ó –ü–†–û–ë–Ü–õ–ê–ú–ò –¢–ê –ü–£–ù–ö–¢–£–ê–¶–Ü–Ñ–Æ ---
        applyRule(/ {2,}/g, ' ');
        applyRule(/\s+([.,;:!?¬ª)])/g, '$1');
        applyRule(/\(\s+/g, '(');
        applyRule(/\s+\)/g, ')');
        applyRule(/([.,;:!?¬ª])([a-zA-Z0-9–∞-—è–ê-–Ø—ñ–Ü—ó–á—î–Ñ“ë“ê])/g, '$1 $2');

        // --- –ï–¢–ê–ü 3: –ó–ê–ú–Ü–ù–ê –°–ò–ú–í–û–õ–Ü–í –Ü –¢–ò–ü–û–ì–†–ê–§–Ü–ö–ê ---
        applyRule(/['` º]/g, '‚Äô');
        applyRule(/ - /g, ' ‚Äî ');
        applyRule(/--/g, ' ‚Äî ');
        applyRule(/^[-‚Äì] /gm, '‚Äî ');
        applyRule(/\.{2,}/g, '...');
        applyRule(/‚Ä¶/g, '...');

        // --- –ï–¢–ê–ü 4: –°–ö–õ–ê–î–ù–Ü –ü–†–ê–í–ò–õ–ê (–õ–ê–ü–ö–ò) ---
        let textBeforeQuotes = text;
        text = text.replace(/[‚Äú‚Äù‚Äû¬´¬ª]/g, '"');
        let inQuote = false;
        text = text.replace(/"/g, () => !inQuote ? (inQuote = true, '¬´') : (inQuote = false, '¬ª'));
        const quoteMatches = textBeforeQuotes.match(/[‚Äú‚Äù‚Äû¬´¬ª"]/g);
        if (quoteMatches) fixesCount += quoteMatches.length;

        // --- –ï–¢–ê–ü 5: –ù–ï–†–û–ó–†–ò–í–ù–Ü –ü–†–û–ë–Ü–õ–ò ---
        applyRule(/(\s[–ê-–Ø–Ü–á–Ñ“ê]\.)(\s*[–ê-–Ø–Ü–á–Ñ“ê]\.)/g, '$1\u00A0$2');
        applyRule(/(\s[–ê-–Ø–Ü–á–Ñ“ê]\.)(\s*[–ê-–Ø–Ü–á–Ñ“ê][–∞-—è—ñ—ó—î“ë]+)/g, '$1\u00A0$2');
        applyRule(/(\s)‚Äî(\s)/g, '\u00A0‚Äî$2');
        applyRule(/(\d)\s(–≥—Ä–Ω|–∫–≥|–º|—Å–º|—à—Ç|—Ç–∏—Å|–º–ª–Ω|–º–ª—Ä–¥)/g, '$1\u00A0$2');
        applyRule(/(\s)(—ñ|–≤|–∑|–Ω–∞|–ø–æ|–¥–æ|—Ç–∞|—É|–∞|–Ω–µ|–∑–∞|—á–∏)(\s)/gi, '$1$2\u00A0');
        
        // --- –ï–¢–ê–ü 6: –í–Ü–î–ù–û–í–õ–ï–ù–ù–Ø –ó–ê–•–ò–©–ï–ù–ò–• –§–†–ê–ì–ú–ï–ù–¢–Ü–í ---
        for (const placeholder in placeholders) {
            text = text.replace(placeholder, placeholders[placeholder]);
        }

        // --- –ó–ê–í–ï–†–®–ï–ù–ù–Ø ---
        document.getElementById("text-input").value = text;
        
        if (fixesCount > 0) {
            updateStatus("–¢–µ–∫—Å—Ç —É—Å–ø—ñ—à–Ω–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ.", fixesCount);
        } else {
            updateStatus("–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø–æ–º–∏–ª–æ–∫ –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.", 0);
        }
    }

    // --- –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á ---
    function copyText() {
        const text = document.getElementById("text-input").value;
        if (!text) {
            updateStatus("–ù–µ–º–∞—î —â–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏.", 0);
            return;
        }
        navigator.clipboard.writeText(text)
            .then(() => updateStatus("–¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –¥–æ –±—É—Ñ–µ—Ä–∞ –æ–±–º—ñ–Ω—É.", -1))
            .catch(() => updateStatus("–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.", 0));
    }

    function clearText() {
        document.getElementById("text-input").value = "";
        updateStatus("–ü–æ–ª–µ –æ—á–∏—â–µ–Ω–æ.", 0);
    }

    function updateStatus(message, count) {
        const statusLabel = document.getElementById("status-label");
        if (count > 0) {
            statusLabel.innerHTML = `${message} –ó–Ω–∞–π–¥–µ–Ω–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å: <span id="fixes-count">${count}</span>`;
        } else if (count === -1) {
            statusLabel.innerHTML = message;
        } else {
            statusLabel.innerHTML = message;
        }
    }
  </script>
</body>
</html>
